"use strict";(self["webpackChunkh990"]=self["webpackChunkh990"]||[]).push([[134],{3134:function(e,t,a){a.r(t),a.d(t,{default:function(){return V}});var n=a(3396),l=a(7139);const r={class:"p-5"},s={class:"steps-content"},c=(0,n._)("span",{class:"me-5"}," 選擇一個CSV檔案： ",-1),i=(0,n.Uk)(" Upload CSV "),o={class:"d-flex justify-content-end"},u=(0,n.Uk)(" 繼續 "),d={key:0,class:"ps-4"},m={class:"d-flex justify-content-end"},p=(0,n.Uk)(" 返回 "),f=(0,n.Uk)(" 繼續 "),w=(0,n.Uk)(" 人員資料正在匯入... "),y={class:"d-flex justify-content-end"},h=(0,n.Uk)(" 前往人員資料 ");function k(e,t,a,k,g,v){const _=(0,n.up)("a-step"),b=(0,n.up)("a-steps"),W=(0,n.up)("upload-outlined"),S=(0,n.up)("a-button"),j=(0,n.up)("a-upload"),O=(0,n.up)("a-card"),U=(0,n.up)("a-table-column"),C=(0,n.up)("a-select-option"),$=(0,n.up)("a-select"),x=(0,n.up)("a-table"),D=(0,n.up)("a-divider"),V=(0,n.up)("a-progress"),Y=(0,n.up)("a-result"),P=(0,n.up)("router-link");return(0,n.wg)(),(0,n.iD)("div",r,[(0,n.Wm)(b,{current:g.current},{default:(0,n.w5)((()=>[(0,n.Wm)(_,{title:"上傳CSV"}),(0,n.Wm)(_,{title:"欄對應"}),(0,n.Wm)(_,{title:"匯入"}),(0,n.Wm)(_,{title:"完成"})])),_:1},8,["current"]),(0,n._)("div",s,[0===g.current?((0,n.wg)(),(0,n.j4)(O,{key:0,class:"my-4",title:"從CSV檔匯入人員資料"},{actions:(0,n.w5)((()=>[(0,n._)("div",o,[(0,n.Wm)(S,{class:"me-2",type:"primary",onClick:t[0]||(t[0]=e=>g.current=g.current+1)},{default:(0,n.w5)((()=>[u])),_:1})])])),default:(0,n.w5)((()=>[c,(0,n.Wm)(j,{showUploadList:!1,name:"file",customRequest:v.readFile},{default:(0,n.w5)((()=>[(0,n.Wm)(S,null,{default:(0,n.w5)((()=>[(0,n.Wm)(W),i])),_:1}),(0,n.Uk)(" "+(0,l.zw)(g.name?g.name:e.$t("noFileSelected")),1)])),_:1},8,["customRequest"])])),_:1})):(0,n.kq)("",!0),1===g.current?((0,n.wg)(),(0,n.j4)(O,{key:1,bodyStyle:{padding:0},class:"my-4 p-0",title:"CSV對應欄位"},{actions:(0,n.w5)((()=>[(0,n._)("div",m,[(0,n.Wm)(S,{class:"me-2",onClick:t[1]||(t[1]=e=>g.current=g.current-1)},{default:(0,n.w5)((()=>[p])),_:1}),(0,n.Wm)(S,{class:"me-2",type:"primary",onClick:v.upload},{default:(0,n.w5)((()=>[f])),_:1},8,["onClick"])])])),default:(0,n.w5)((()=>[(0,n.Wm)(x,{size:"small","data-source":g.renderData,pagination:!1},{bodyCell:(0,n.w5)((({column:e,text:t,record:a})=>[e&&"columnName"===e.key?((0,n.wg)(),(0,n.iD)("div",d,(0,l.zw)(t),1)):e&&"action"===e.key?((0,n.wg)(),(0,n.j4)($,{key:1,value:g.list[a.name],"onUpdate:value":e=>g.list[a.name]=e,style:{width:"100%"}},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(g.importTitle,(e=>((0,n.wg)(),(0,n.j4)(C,{allowClear:"true",key:e,value:e},{default:(0,n.w5)((()=>[(0,n.Uk)((0,l.zw)(e),1)])),_:2},1032,["value"])))),128))])),_:2},1032,["value","onUpdate:value"])):(0,n.kq)("",!0)])),default:(0,n.w5)((()=>[(0,n.Wm)(U,{class:"text-nowrap ps-4",key:"columnName",title:"欄位名稱","data-index":"name"}),(0,n.Wm)(U,{width:"40%",key:"action",title:"對應至欄位","data-index":"action"})])),_:1},8,["data-source"])])),_:1})):(0,n.kq)("",!0),2===g.current?((0,n.wg)(),(0,n.j4)(O,{key:2,class:"my-4",title:"匯入中"},{default:(0,n.w5)((()=>[w,(0,n.Wm)(D),(0,n.Wm)(V,{"stroke-color":"#384893",showInfo:!1,percent:g.defaultPercent},null,8,["percent"])])),_:1})):(0,n.kq)("",!0),3===g.current?((0,n.wg)(),(0,n.j4)(O,{key:3,class:"my-4",title:"完成!"},{actions:(0,n.w5)((()=>[(0,n.Wm)(P,{to:"/home/person"},{default:(0,n.w5)((()=>[(0,n._)("div",y,[(0,n.Wm)(S,{class:"me-2",type:"primary"},{default:(0,n.w5)((()=>[h])),_:1})])])),_:1})])),default:(0,n.w5)((()=>[(0,n.Wm)(Y,{status:"success",title:"匯入完成!","sub-title":`${g.total}名人員匯入成功!已上傳檔案${g.name}`},null,8,["sub-title"])])),_:1})):(0,n.kq)("",!0)])])}a(7658);var g={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},v=g,_=a(9388);function b(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?Object(arguments[t]):{},n=Object.keys(a);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),n.forEach((function(t){W(e,t,a[t])}))}return e}function W(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var S=function(e,t){var a=b({},e,t.attrs);return(0,n.Wm)(_.Z,b({},a,{icon:v}),null)};S.displayName="UploadOutlined",S.inheritAttrs=!1;var j=S,O=a(5743),U=a.n(O),C=a(2074),$={components:{UploadOutlined:j},data(){return{defaultPercent:10,list:{},renderData:[{name:"username"},{name:"person_id"},{name:"card_id"},{name:"email"},{name:"created_since"},{name:"valid_till"}],current:0,name:"",dataString:"",importTitle:"",total:0}},methods:{dayjs:U(),readFile(e){const t=this,a=e.file;if("text/csv"!==a.type)return void C.ZP.error("請選擇csv檔");const n=new FileReader;t.name=e.file.name,n.readAsText(a),n.onload=function(){const e=n.result.replace(/\r\n[\r\n]+/g,"\r\n").replace(/\r\n$/,"");t.dataString=e,t.importTitle=e.split("\r\n")[0].split(",")}},upload(){this.current=2,setInterval((()=>{this.defaultPercent+=15}),500);const e=performance.now(),t=JSON.parse(sessionStorage.getItem("person")),a=t[t.length-1].id,n=this.dataString.split("\r\n"),l={},r={...this.list},s=[];let c="",i=[];n.forEach(((e,t)=>{const a=e.split(",");if(0===t)return i=a,i.forEach((e=>{l[e]=[]})),!1;for(let n=0;n<i.length;n++)l[i[n]].push(a[n])}));for(let d=0;d<n.length-1;d++){c="";for(const e in r)switch(e){case"created_since":c+=`"${e}":"${U()(l[r[e]][d]).format("YYYY-MM-DDTHH:mm:ss.000001")}",`;break;case"valid_till":c+=`"${e}":"${U()(l[r[e]][d]).format("YYYY-MM-DDTHH:mm:ss.999999")}",`;break;default:c+=`"${e}":"${l[r[e]][d]}",`;break}c+=`"id":"${a+d}"`,c=`{${c}}`,s.push(JSON.parse(c))}this.total=s.length;const o=t.concat(s);sessionStorage.setItem("person",JSON.stringify(o));const u=performance.now();console.log(u-e),u-e>3e3?this.current=3:setTimeout((()=>{this.current=3}),3e3)}},created(){}},x=a(89);const D=(0,x.Z)($,[["render",k]]);var V=D}}]);